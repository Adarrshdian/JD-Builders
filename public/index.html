<!DOCTYPE html>
<html lang="en">
<head>
  <title>HR Content Helper</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="https://unpkg.com/lucide@latest/dist/umd/lucide.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --primary-color: #ff8c42;
      --secondary-color: #ff6b35;
      --accent-color: #4ade80;
      --error-color: #ef4444;
      --warning-color: #f59e0b;
      --background: linear-gradient(135deg, #fff8f0, #fffbf7);
      --card-bg: #ffffff;
      --text-color: #1f2937;
      --text-secondary: #6b7280;
      --border-color: #f0d4bb;
      --shadow: 0 8px 30px rgba(0,0,0,0.08);
      --shadow-hover: 0 12px 40px rgba(0,0,0,0.12);
      --radius: 12px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    [data-theme="dark"] {
      --background: linear-gradient(135deg, #1a1a2e, #16213e);
      --card-bg: #2a2a3e;
      --text-color: #e2e8f0;
      --text-secondary: #94a3b8;
      --border-color: #374151;
      --shadow: 0 8px 30px rgba(0,0,0,0.3);
      --shadow-hover: 0 12px 40px rgba(0,0,0,0.4);
    }

    body {
      font-family: "Segoe UI", Roboto, sans-serif;
      background: var(--background);
      min-height: 100vh;
      padding: 20px;
      color: var(--text-color);
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 32px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 30px;
      max-width: 1100px;
      margin: auto;
      box-shadow: 0 8px 30px rgba(0,0,0,0.08);
      transition: transform 0.2s ease;
    }

    .card:hover {
      transform: translateY(-2px);
    }

    .auth-card {
      max-width: 420px;
      margin: auto auto 30px;
      text-align: center;
    }

    .user-info {
      text-align: right;
      font-size: 14px;
      margin-bottom: 10px;
    }

    button.logout {
      background: none;
      border: none;
      color: var(--secondary-color);
      font-weight: 600;
      cursor: pointer;
      transition: color 0.2s;
    }

    button.logout:hover {
      color: var(--primary-color);
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 2px solid var(--border-color);
      margin-bottom: 12px;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-color);
    }

    textarea { min-height: 160px; }

    button {
      padding: 10px 18px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      margin-bottom: 6px;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }

    button.secondary {
      background: var(--card-bg);
      color: var(--secondary-color);
      border: 1px solid #ffd0aa;
    }

    button.secondary:hover {
      background: var(--secondary-color);
      color: white;
    }

    /* Header and Subtitle */
    .header {
      text-align: center;
      margin-bottom: 30px;
      position: relative;
    }

    .theme-toggle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--card-bg);
      border: 2px solid var(--border-color);
      cursor: pointer;
      transition: var(--transition);
      padding: 0;
      margin: 0;
    }

    .theme-toggle svg {
      width: 20px;
      height: 20px;
      stroke: var(--text-color) !important;
      fill: none;
    }

    .theme-toggle:hover {
      border-color: var(--primary-color);
      transform: rotate(20deg) translateY(0);
      box-shadow: 0 2px 8px rgba(255, 140, 66, 0.3);
    }

    .theme-toggle:hover svg {
      stroke: var(--primary-color) !important;
    }

    .subtitle {
      color: var(--text-secondary);
      font-size: 16px;
      margin-top: 10px;
    }

    /* User Profile Bar */
    .user-profile-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 20px;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      border: 2px solid var(--border-color);
      transition: var(--transition);
      max-width: 1100px;
      margin-left: auto;
      margin-right: auto;
    }

    .user-profile-bar:hover {
      border-color: var(--primary-color);
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    .profile-pic {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 20px;
      text-transform: uppercase;
      border: 3px solid var(--border-color);
      flex-shrink: 0;
    }

    .profile-pic img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
    }

    .user-details {
      flex: 1;
    }

    .user-name {
      font-weight: 600;
      font-size: 16px;
      color: var(--text-color);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .user-email {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 2px;
    }

    .logout-btn {
      padding: 8px 16px;
      background: linear-gradient(135deg, var(--secondary-color), var(--error-color));
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: var(--transition);
      margin: 0;
    }

    .logout-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }

    /* Input Icon Wrapper */
    .input-icon {
      position: relative;
      margin-bottom: 12px;
    }

    .input-icon input {
      width: 100%;
      padding-right: 40px;
      margin-bottom: 0;
    }

    .input-icon i {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      pointer-events: none;
    }

    /* Alert Styles */
    .alert {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 15px;
      font-size: 14px;
    }

    .alert.error {
      background: #fee;
      color: var(--error-color);
      border: 1px solid var(--error-color);
    }

    .alert.success {
      background: #efe;
      color: #22c55e;
      border: 1px solid #22c55e;
    }

    .alert.warning {
      background: #fef3e0;
      color: var(--warning-color);
      border: 1px solid var(--warning-color);
    }

    .dynamic-field {
      display: flex;
      gap: 10px;
      margin-bottom: 8px;
    }

    .dynamic-field input { flex: 1; }

    #output {
      margin-top: 20px;
      padding: 16px;
      border-radius: 8px;
      background: #fafaf8;
      border: 2px solid var(--border-color);
      white-space: pre-wrap;
      min-height: 120px;
      transition: background 0.2s;
    }

    #output.loading {
      background: #f0f0f0;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .split-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .section {
      padding: 20px;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      background: var(--card-bg);
      transition: border-color 0.2s;
    }

    .section:hover {
      border-color: var(--primary-color);
    }

    .section h3 {
      margin-bottom: 12px;
      color: var(--secondary-color);
    }

    @media (max-width: 768px) {
      .split-container {
        grid-template-columns: 1fr;
      }
    }

    /* TEMPLATE */
    .template {
      width: 1080px;
      height: 1080px;
      display: none;
      position: relative;
      color: #ffffff;
    }

    #templateImage {
      background: url("/assets/bg2.png") center / cover no-repeat;
    }

    #templateImage.theme-modern {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    #templateImage.theme-professional {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    }

    #templateImage.theme-vibrant {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    #templateImage.theme-minimalist {
      background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
      color: #333333;
    }

    #templateImage.theme-dark {
      background: linear-gradient(135deg, #232526 0%, #414345 100%);
    }

    .title {
      position: absolute;
      top: 110px;
      left: 100px;
      font-size: 52px;
      font-weight: 700;
    }

    .content {
      position: absolute;
      top: 210px;
      left: 100px;
      width: 780px;
      height: 720px;
      overflow: hidden;
    }

    .content-inner {
      font-size: 24px;
      line-height: 1.45;
      white-space: pre-wrap;
    }

    footer {
      position: absolute;
      bottom: 70px;
      right: 100px;
      font-size: 18px;
      opacity: 0.85;
    }

    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      margin-left: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error {
      color: #e74c3c;
      font-size: 14px;
      margin-top: 10px;
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* New Feature Styles */
    select {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 2px solid var(--border-color);
      margin-bottom: 12px;
      font-size: 14px;
      background: var(--card-bg);
      color: var(--text-color);
      cursor: pointer;
    }

    select:focus {
      outline: none;
      border-color: var(--primary-color);
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid var(--border-color);
    }

    .tab {
      padding: 12px 24px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-weight: 600;
      color: var(--text-secondary);
      transition: all 0.3s;
    }

    .tab.active {
      color: var(--primary-color);
      border-bottom-color: var(--primary-color);
    }

    .tab:hover {
      color: var(--secondary-color);
      transform: none;
      box-shadow: none;
    }

    .variant-container {
      display: none;
      padding: 16px;
      border-radius: 8px;
      background: var(--card-bg);
      border: 2px solid var(--border-color);
      margin-bottom: 10px;
    }

    .variant-container.active {
      display: block;
    }

    .metrics {
      display: flex;
      gap: 20px;
      margin-top: 10px;
      font-size: 13px;
      color: var(--text-secondary);
    }

    .metric-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .template-library {
      margin-top: 20px;
      padding: 20px;
      border: 2px solid var(--border-color);
      border-radius: 10px;
    }

    .template-item {
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .template-item:hover {
      border-color: var(--primary-color);
      transform: translateX(5px);
    }

    .template-actions {
      display: flex;
      gap: 8px;
    }

    .template-actions button {
      padding: 6px 12px;
      font-size: 12px;
    }

    .export-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .export-buttons button {
      flex: 1;
      min-width: 120px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 14px;
      color: var(--text-color);
    }
  </style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>

<body>

<div class="container">
  <header class="header">
    <h1>HR Content Helper</h1>
    <p class="subtitle">Create professional LinkedIn posts with AI assistance</p>
  </header>

  <!-- AUTH -->
  <div id="authSection" class="card auth-card fade-in" role="main" aria-labelledby="auth-title">
    <h3 id="auth-title"><i data-lucide="lock"></i> Login / Signup</h3>
    <div id="authError" class="alert error" style="display:none;">
      <i data-lucide="alert-circle"></i>
      <span id="authErrorText"></span>
    </div>
    <div class="form-group">
      <label for="email">Email Address</label>
      <div class="input-icon">
        <input id="email" placeholder="Enter your email" type="email" aria-label="Email address" required />
        <i data-lucide="mail"></i>
      </div>
    </div>
    <div class="form-group">
      <label for="password">Password</label>
      <div class="input-icon">
        <input id="password" type="password" placeholder="Enter your password" aria-label="Password" required />
        <i data-lucide="lock"></i>
      </div>
    </div>
    <button onclick="signup()" aria-label="Sign up with email"><i data-lucide="user-plus"></i> Sign Up</button>
    <button onclick="login()" aria-label="Login with email"><i data-lucide="log-in"></i> Login</button>
    <button class="secondary" onclick="googleLogin()" aria-label="Continue with Google"><i data-lucide="chrome"></i> Continue with Google</button>
    <br><br>
    <button class="secondary" onclick="testLogin()" aria-label="Test login with demo account" style="background: var(--accent-color); color: white; border-color: var(--accent-color);">
      <i data-lucide="user-check"></i> Try Demo Account
    </button>
    <p style="font-size: 12px; color: var(--text-secondary); margin-top: 10px; text-align: center;">
      Demo: demo@example.com / demo123
    </p>
  </div>

  <div id="userBar" class="user-profile-bar fade-in" style="display:none">
    <div class="profile-pic" id="profilePic">
      <i data-lucide="user"></i>
    </div>
    <div class="user-details">
      <div class="user-name">
        <i data-lucide="user-check" style="width: 16px; height: 16px;"></i>
        <strong id="userName"></strong>
      </div>
      <div class="user-email" id="userEmail"></div>
    </div>
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
      <i data-lucide="sun" class="theme-icon"></i>
    </button>
    <button class="logout-btn" onclick="logout()" aria-label="Logout">
      <i data-lucide="log-out"></i>
      Logout
    </button>
  </div>

  <!-- APP -->
  <div id="appSection" class="card" style="display:none" role="main" aria-labelledby="app-title">
  <h2 id="app-title" style="display:none">HR Content Helper Application</h2>

  <div class="split-container">

    <div class="section">
      <h3><i data-lucide="message-square"></i> Prompt Mode</h3>
      <div class="form-group">
        <label for="inputText">Describe your job posting requirements</label>
        <textarea id="inputText" placeholder="e.g., We are hiring a Senior Software Engineer with 5+ years experience in React and Node.js..." aria-label="Prompt input"></textarea>
      </div>
      <div class="form-group">
        <label for="tonePrompt">Tone</label>
        <select id="tonePrompt" aria-label="Select tone">
          <option value="professional">Professional</option>
          <option value="friendly">Friendly</option>
          <option value="concise">Concise</option>
          <option value="enthusiastic">Enthusiastic</option>
        </select>
      </div>
      <button onclick="enhanceFromPrompt()" id="promptBtn" aria-label="Enhance from prompt"><i data-lucide="sparkles"></i> Enhance from Prompt</button>
    </div>

    <div class="section">
      <h3><i data-lucide="form-input"></i> Form Mode</h3>
      <div class="form-group">
        <label for="companyName">Company Name</label>
        <input id="companyName" placeholder="e.g., TechCorp Inc." aria-label="Company name" />
      </div>
      <div class="form-group">
        <label for="role">Job Role</label>
        <input id="role" placeholder="e.g., Senior Developer" aria-label="Job role" />
      </div>
      <div class="form-group">
        <label for="skills">Required Skills</label>
        <input id="skills" placeholder="e.g., JavaScript, React, Node.js" aria-label="Skills" />
      </div>
      <div class="form-group">
        <label for="eligibility">Eligibility Criteria</label>
        <input id="eligibility" placeholder="e.g., Bachelor's degree, 3+ years experience" aria-label="Eligibility criteria" />
      </div>

      <div class="form-group">
        <label for="contact">Contact</label>
        <input id="contact" placeholder="e.g., email@company.com or +1234567890" aria-label="Contact information" />
      </div>
      <div class="form-group">
        <label for="yearsOfExperience">Years of Experience</label>
        <input id="yearsOfExperience" placeholder="e.g., 3-5 years" aria-label="Years of experience" />
      </div>
      <div class="form-group">
        <label for="location">Location</label>
        <input id="location" placeholder="e.g., New York, NY or Remote" aria-label="Job location" />
      </div>
      <div class="form-group">
        <label for="workMode">Work Mode</label>
        <select id="workMode" aria-label="Select work mode">
          <option value="">Select work mode</option>
          <option value="remote">Remote</option>
          <option value="hybrid">Hybrid</option>
          <option value="onsite">On-site</option>
        </select>
      </div>

      <div class="form-group">
        <label for="companyWebsite">Company Website</label>
        <input id="companyWebsite" placeholder="https://company.com" type="url" aria-label="Company website" />
      </div>
      <div class="form-group">
        <label for="companyLogo">Company Logo</label>
        <input id="companyLogo" type="file" accept="image/*" aria-label="Company logo upload" />
      </div>

      <div class="form-group">
        <label for="toneForm">Tone</label>
        <select id="toneForm" aria-label="Select tone">
          <option value="professional">Professional</option>
          <option value="friendly">Friendly</option>
          <option value="concise">Concise</option>
          <option value="enthusiastic">Enthusiastic</option>
        </select>
      </div>

      <div id="dynamicFields" aria-label="Additional fields"></div>
      <div style="display: flex; gap: 10px; margin-top: 10px;">
        <button class="secondary add-field-btn" onclick="addDynamicField()" aria-label="Add additional field" style="flex: 1;">
          <i data-lucide="plus"></i> Add Custom Field
        </button>
        <button onclick="enhanceFromForm()" id="formBtn" aria-label="Enhance from form" style="flex: 1;">
          <i data-lucide="sparkles"></i> 
        </button>
      </div>
    </div>

  </div>

  <br>
  
  <!-- Template Theme Selector -->
  <div class="section" style="max-width: 1100px; margin: 0 auto 20px;">
    <h3><i data-lucide="palette"></i> Select Template Theme</h3>
    <div class="form-group">
      <label for="templateTheme">Choose a visual template design for download:</label>
      <select id="templateTheme" aria-label="Select template theme" onchange="updateTemplatePreview()">
        <option value="theme-default">Default (Image Background)</option>
        <option value="theme-modern">Modern Purple</option>
        <option value="theme-professional">Professional Blue</option>
        <option value="theme-vibrant">Vibrant Pink</option>
        <option value="theme-minimalist">Minimalist White</option>
        <option value="theme-dark">Dark Mode</option>
      </select>
    </div>
    <div style="padding: 10px; background: var(--card-bg); border: 2px solid var(--border-color); border-radius: 8px; text-align: center;">
      <small style="color: var(--text-secondary);">Preview: The selected theme will be applied when you download the image</small>
    </div>
  </div>
  
  <!-- Output Tabs for 3 Variants -->
  <div class="tabs">
    <button class="tab active" onclick="switchTab('short')" id="tabShort">
      <i data-lucide="file-text"></i> Short Post
    </button>
    <button class="tab" onclick="switchTab('long')" id="tabLong">
      <i data-lucide="file-text"></i> Long Post
    </button>
    <button class="tab" onclick="switchTab('ats')" id="tabAts">
      <i data-lucide="file-check"></i> ATS Description
    </button>
  </div>

  <div id="outputShort" class="variant-container active" aria-live="polite">
    <div class="metrics">
      <div class="metric-item"><i data-lucide="type"></i> <span id="wordsShort">0</span> words</div>
      <div class="metric-item"><i data-lucide="hash"></i> <span id="charsShort">0</span> characters</div>
      <div class="metric-item"><i data-lucide="clock"></i> <span id="readTimeShort">0</span> min read</div>
    </div>
    <div id="contentShort" style="margin-top: 15px; padding: 16px; border-radius: 8px; background: #fafaf8; border: 2px solid var(--border-color); white-space: pre-wrap; min-height: 120px; color: #2c3e50;">
      Short LinkedIn post will appear here...
    </div>
  </div>

  <div id="outputLong" class="variant-container" aria-live="polite">
    <div class="metrics">
      <div class="metric-item"><i data-lucide="type"></i> <span id="wordsLong">0</span> words</div>
      <div class="metric-item"><i data-lucide="hash"></i> <span id="charsLong">0</span> characters</div>
      <div class="metric-item"><i data-lucide="clock"></i> <span id="readTimeLong">0</span> min read</div>
    </div>
    <div id="contentLong" style="margin-top: 15px; padding: 16px; border-radius: 8px; background: #fafaf8; border: 2px solid var(--border-color); white-space: pre-wrap; min-height: 120px; color: #2c3e50;">
      Long LinkedIn post will appear here...
    </div>
  </div>

  <div id="outputAts" class="variant-container" aria-live="polite">
    <div class="metrics">
      <div class="metric-item"><i data-lucide="type"></i> <span id="wordsAts">0</span> words</div>
      <div class="metric-item"><i data-lucide="hash"></i> <span id="charsAts">0</span> characters</div>
      <div class="metric-item"><i data-lucide="clock"></i> <span id="readTimeAts">0</span> min read</div>
    </div>
    <div id="contentAts" style="margin-top: 15px; padding: 16px; border-radius: 8px; background: #fafaf8; border: 2px solid var(--border-color); white-space: pre-wrap; min-height: 120px; color: #2c3e50;">
      ATS-friendly job description will appear here...
    </div>
  </div>

  <!-- Export Options -->
  <div class="export-buttons">
    <button onclick="copyToClipboard()" aria-label="Copy to clipboard">
      <i data-lucide="copy"></i> Copy
    </button>
    <button onclick="saveAsTemplate()" aria-label="Save as template">
      <i data-lucide="save"></i> Save Template
    </button>
    <button class="secondary" onclick="exportToPDF()" aria-label="Export to PDF">
      <i data-lucide="file-down"></i> Export PDF
    </button>

    <button class="secondary" onclick="applyTemplateAndDownload()" id="downloadBtn" aria-label="Download image">
      <i data-lucide="download"></i> Download Image
    </button>
  </div>

  <!-- Template Library -->
  <div class="template-library">
    <h3><i data-lucide="folder"></i> Saved Templates</h3>
    <div id="templateList">
      <p style="color: var(--text-secondary); font-size: 14px;">No templates saved yet. Generate content and click "Save Template" to start building your library.</p>
    </div>
  </div>

  <div id="errorMsg" class="alert error" style="display:none;">
    <i data-lucide="alert-triangle"></i>
    <span id="errorText"></span>
  </div>
</div>

<!-- TEMPLATE -->
<div id="templateImage" class="template">
  <div id="logoContainer" class="logo-container" style="position: absolute; top: 30px; left: 100px; display: none;">
    <img id="templateLogo" style="max-width: 120px; max-height: 80px; object-fit: contain;" />
  </div>
  <div class="title">We Are Hiring</div>
  <div class="content">
    <div id="contentImage" class="content-inner"></div>
  </div>
  <footer id="footerText">Apply Now</footer>
</div>

<script>
  /* FIREBASE */
  const firebaseConfig = {
    apiKey: "{{FIREBASE_API_KEY}}",
    authDomain: "{{FIREBASE_AUTH_DOMAIN}}",
    projectId: "{{FIREBASE_PROJECT_ID}}",
    storageBucket: "{{FIREBASE_STORAGE_BUCKET}}",
    messagingSenderId: "{{FIREBASE_MESSAGING_SENDER_ID}}",
    appId: "{{FIREBASE_APP_ID}}"
  };

  // Add error handling for Firebase initialization
  try {
    firebase.initializeApp(firebaseConfig);
    console.log('Firebase initialized successfully');
    console.log('Firebase config loaded:', {
      apiKey: firebaseConfig.apiKey ? '‚úì Present' : '‚úó Missing',
      authDomain: firebaseConfig.authDomain ? '‚úì Present' : '‚úó Missing',
      projectId: firebaseConfig.projectId ? '‚úì Present' : '‚úó Missing'
    });
  } catch (error) {
    console.error('Firebase initialization error:', error);
    showAuthError('Firebase configuration error. Please check console for details.');
  }

  const auth = firebase.auth();

  // Debug: Log auth state changes
  auth.onAuthStateChanged(user => {
    console.log('Auth state changed:', user ? `Logged in as ${user.email}` : 'No user');
    if (user) {
      openApp(user);
    } else {
      showLogin();
    }
  });

  function showLogin() {
    document.getElementById('authSection').style.display = 'block';
    document.getElementById('appSection').style.display = 'none';
    document.getElementById('userBar').style.display = 'none';
  }

  function signup() {
    const emailVal = email.value.trim();
    const passVal = password.value.trim();

    if (!emailVal || !passVal) {
      showAuthError("Please enter both email and password.");
      return;
    }

    if (passVal.length < 6) {
      showAuthError("Password must be at least 6 characters long.");
      return;
    }

    console.log('Attempting signup for:', emailVal);
    auth.createUserWithEmailAndPassword(emailVal, passVal)
      .then(result => {
        console.log('Signup successful:', result.user.email);
        showAlert('Account created successfully! Welcome!', 'success');
      })
      .catch(err => {
        console.error('Signup error:', err);
        handleAuthError(err);
      });
  }

  function login() {
    const emailVal = email.value.trim();
    const passVal = password.value.trim();

    if (!emailVal || !passVal) {
      showAuthError("Please enter both email and password.");
      return;
    }

    console.log('Attempting login for:', emailVal);
    auth.signInWithEmailAndPassword(emailVal, passVal)
      .then(result => {
        console.log('Login successful:', result.user.email);
        showAlert('Login successful! Welcome back!', 'success');
      })
      .catch(err => {
        console.error('Login error:', err);
        handleAuthError(err);
      });
  }

  function googleLogin() {
    console.log('Attempting Google login');
    const provider = new firebase.auth.GoogleAuthProvider();
    provider.addScope('email');
    provider.addScope('profile');

    auth.signInWithPopup(provider)
      .then(result => {
        console.log('Google login successful:', result.user.email);
        showAlert('Google login successful! Welcome!', 'success');
      })
      .catch(err => {
        console.error('Google login error:', err);
        handleAuthError(err);
      });
  }

  function testLogin() {
    console.log('Attempting demo login');
    const demoEmail = 'demo@example.com';
    const demoPassword = 'demo123';

    // First try to login
    auth.signInWithEmailAndPassword(demoEmail, demoPassword)
      .then(result => {
        console.log('Demo login successful:', result.user.email);
        showAlert('Demo login successful! Welcome!', 'success');
      })
      .catch(err => {
        // If login fails, try to create account
        if (err.code === 'auth/user-not-found') {
          console.log('Demo account not found, creating...');
          auth.createUserWithEmailAndPassword(demoEmail, demoPassword)
            .then(result => {
              console.log('Demo account created and logged in:', result.user.email);
              showAlert('Demo account created! Welcome!', 'success');
            })
            .catch(createErr => {
              console.error('Demo account creation error:', createErr);
              handleAuthError(createErr);
            });
        } else {
          console.error('Demo login error:', err);
          handleAuthError(err);
        }
      });
  }

  function handleAuthError(error) {
    let message = 'An error occurred during authentication.';

    switch (error.code) {
      case 'auth/invalid-email':
        message = 'Invalid email address format.';
        break;
      case 'auth/user-disabled':
        message = 'This account has been disabled.';
        break;
      case 'auth/user-not-found':
        message = 'No account found with this email address.';
        break;
      case 'auth/wrong-password':
        message = 'Incorrect password.';
        break;
      case 'auth/email-already-in-use':
        message = 'An account with this email already exists.';
        break;
      case 'auth/weak-password':
        message = 'Password is too weak. Please choose a stronger password.';
        break;
      case 'auth/operation-not-allowed':
        message = 'This sign-in method is not enabled. Please contact support.';
        break;
      case 'auth/account-exists-with-different-credential':
        message = 'An account already exists with the same email but different sign-in credentials.';
        break;
      case 'auth/popup-blocked':
        message = 'Popup was blocked by browser. Please allow popups for this site.';
        break;
      case 'auth/popup-closed-by-user':
        message = 'Google sign-in was cancelled.';
        break;
      case 'auth/cancelled-popup-request':
        message = 'Another popup is already open.';
        break;
      case 'auth/network-request-failed':
        message = 'Network error. Please check your internet connection.';
        break;
      default:
        message = error.message || 'Authentication failed. Please try again.';
    }

    showAuthError(message);
  }

  function logout() {
    console.log('Logging out user');
    auth.signOut()
      .then(() => {
        console.log('Logout successful');
        showAlert('Logged out successfully', 'success');
        // Reset form
        email.value = '';
        password.value = '';
        output.innerText = '';
        // Clear dynamic fields
        dynamicFields.innerHTML = '';
      })
      .catch(err => {
        console.error('Logout error:', err);
        showAlert('Error logging out', 'error');
      });
  }

  function openApp(user) {
    console.log('Opening app for user:', user.email);
    document.getElementById('authSection').style.display = 'none';
    document.getElementById('appSection').style.display = 'block';
    document.getElementById('userBar').style.display = 'flex';
    
    // Set user name
    const displayName = user.displayName || user.email.split('@')[0];
    document.getElementById('userName').textContent = displayName;
    document.getElementById('userEmail').textContent = user.email;
    
    // Set profile picture
    const profilePic = document.getElementById('profilePic');
    if (user.photoURL) {
      profilePic.innerHTML = `<img src="${user.photoURL}" alt="Profile picture" />`;
    } else {
      // Use first letter of email as avatar
      const initial = user.email.charAt(0).toUpperCase();
      profilePic.textContent = initial;
    }

    // Load theme preference and templates
    loadTheme();
    lucide.createIcons();
  }

  function addDynamicField() {
    const div = document.createElement("div");
    div.className = "dynamic-field fade-in";
    div.innerHTML = `
      <input class="key" placeholder="Field name (e.g., Salary)" aria-label="Custom field name">
      <input class="value" placeholder="Field value (e.g., $80k-$100k)" aria-label="Custom field value">
      <button type="button" onclick="removeDynamicField(this)" aria-label="Remove field">
        <i data-lucide="x"></i>
      </button>
    `;
    dynamicFields.appendChild(div);
    lucide.createIcons();
  }

  function removeDynamicField(button) {
    button.parentElement.remove();
  }

  function collectDynamicFields() {
    const obj = {};
    document.querySelectorAll(".dynamic-field").forEach(r => {
      const k = r.querySelector(".key").value.trim();
      const v = r.querySelector(".value").value.trim();
      if (k && v) obj[k] = v;
    });
    return obj;
  }

  async function enhanceFromPrompt() {
    const text = inputText.value.trim();
    const tone = document.getElementById('tonePrompt').value;
    
    if (!text) {
      showError("Please enter a prompt.");
      return;
    }
    setLoading(true, 'promptBtn');
    try {
      const r = await fetch("http://localhost:5000/enhance", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text, tone })
      });
      if (!r.ok) throw new Error("Failed to enhance prompt.");
      const data = await r.json();
      parseAndDisplayVariants(data.enhanced);
      hideError();
    } catch (err) {
      showError(err.message);
    } finally {
      setLoading(false, 'promptBtn');
    }
  }

  async function enhanceFromForm() {
    const tone = document.getElementById('toneForm').value;
    
    const payload = {
      companyName: companyName.value,
      role: role.value,
      skills: skills.value,
      eligibility: eligibility.value,
      companyWebsite: companyWebsite.value,
      tone: tone,
      extraFields: collectDynamicFields()
    };

    if (!payload.companyName || !payload.role) {
      showError("Please fill in at least Company Name and Role.");
      return;
    }

    setLoading(true, 'formBtn');
    try {
      const r = await fetch("http://localhost:5000/formenhance", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      if (!r.ok) throw new Error("Failed to enhance from form.");
      const data = await r.json();
      parseAndDisplayVariants(data.enhanced);
      hideError();
    } catch (err) {
      showError(err.message);
    } finally {
      setLoading(false, 'formBtn');
    }
  }

  // Parse AI response and display in tabs
  function parseAndDisplayVariants(content) {
    const shortMatch = content.match(/===\s*SHORT POST\s*===\s*([\s\S]*?)(?====|$)/i);
    const longMatch = content.match(/===\s*LONG POST\s*===\s*([\s\S]*?)(?====|$)/i);
    const atsMatch = content.match(/===\s*ATS DESCRIPTION\s*===\s*([\s\S]*?)(?=$)/i);

    const shortContent = shortMatch ? shortMatch[1].trim() : content;
    const longContent = longMatch ? longMatch[1].trim() : '';
    const atsContent = atsMatch ? atsMatch[1].trim() : '';

    updateVariant('Short', shortContent);
    updateVariant('Long', longContent || shortContent);
    updateVariant('Ats', atsContent || shortContent);
  }

  function updateVariant(type, content) {
    const contentEl = document.getElementById(`content${type}`);
    const wordsEl = document.getElementById(`words${type}`);
    const charsEl = document.getElementById(`chars${type}`);
    const readTimeEl = document.getElementById(`readTime${type}`);

    contentEl.innerText = content;

    const words = content.split(/\s+/).filter(w => w.length > 0).length;
    const chars = content.length;
    const readTime = Math.ceil(words / 200); // Average reading speed

    wordsEl.innerText = words;
    charsEl.innerText = chars;
    readTimeEl.innerText = readTime;
  }

  // Tab switching
  let currentTab = 'short';
  function switchTab(tab) {
    // Update tab buttons
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById(`tab${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.add('active');

    // Update content containers
    document.querySelectorAll('.variant-container').forEach(c => c.classList.remove('active'));
    document.getElementById(`output${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.add('active');

    currentTab = tab;
  }

  // Copy current tab content
  async function copyToClipboard() {
    const contentId = `content${currentTab.charAt(0).toUpperCase() + currentTab.slice(1)}`;
    const text = document.getElementById(contentId).innerText;
    
    if (!text.trim() || text.includes('will appear here')) {
      showAlert('No content to copy', 'warning');
      return;
    }
    
    try {
      await navigator.clipboard.writeText(text);
      showAlert('Content copied to clipboard!', 'success');
    } catch (err) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      showAlert('Content copied to clipboard!', 'success');
    }
  }

  // Template Library Functions
  function saveAsTemplate() {
    const shortContent = document.getElementById('contentShort').innerText;
    const longContent = document.getElementById('contentLong').innerText;
    const atsContent = document.getElementById('contentAts').innerText;

    if (!shortContent || shortContent.includes('will appear here')) {
      showAlert('Generate content first before saving!', 'warning');
      return;
    }

    const template = {
      id: Date.now(),
      timestamp: new Date().toISOString(),
      company: document.getElementById('companyName').value || 'Unnamed',
      role: document.getElementById('role').value || 'Position',
      tone: document.getElementById('toneForm').value || document.getElementById('tonePrompt').value,
      variants: {
        short: shortContent,
        long: longContent,
        ats: atsContent
      }
    };

    let templates = JSON.parse(localStorage.getItem('hrTemplates') || '[]');
    templates.unshift(template);
    localStorage.setItem('hrTemplates', JSON.stringify(templates));

    loadTemplates();
    showAlert('Template saved successfully!', 'success');
  }

  function loadTemplates() {
    const templates = JSON.parse(localStorage.getItem('hrTemplates') || '[]');
    const listEl = document.getElementById('templateList');

    if (templates.length === 0) {
      listEl.innerHTML = '<p style="color: var(--text-secondary); font-size: 14px;">No templates saved yet.</p>';
      return;
    }

    listEl.innerHTML = templates.map(t => `
      <div class="template-item">
        <div>
          <strong>${t.company} - ${t.role}</strong>
          <br>
          <small style="color: var(--text-secondary);">${new Date(t.timestamp).toLocaleDateString()} ‚Ä¢ ${t.tone || 'professional'}</small>
        </div>
        <div class="template-actions">
          <button onclick="loadTemplate(${t.id})" style="background: var(--accent-color);">
            <i data-lucide="eye"></i> Load
          </button>
          <button onclick="deleteTemplate(${t.id})" style="background: var(--error-color);">
            <i data-lucide="trash-2"></i> Delete
          </button>
        </div>
      </div>
    `).join('');

    lucide.createIcons();
  }

  function loadTemplate(id) {
    const templates = JSON.parse(localStorage.getItem('hrTemplates') || '[]');
    const template = templates.find(t => t.id === id);

    if (!template) return;

    updateVariant('Short', template.variants.short);
    updateVariant('Long', template.variants.long);
    updateVariant('Ats', template.variants.ats);

    showAlert('Template loaded!', 'success');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function deleteTemplate(id) {
    if (!confirm('Are you sure you want to delete this template?')) return;

    let templates = JSON.parse(localStorage.getItem('hrTemplates') || '[]');
    templates = templates.filter(t => t.id !== id);
    localStorage.setItem('hrTemplates', JSON.stringify(templates));

    loadTemplates();
    showAlert('Template deleted', 'success');
  }

  // Export Functions
  function exportToPDF() {
    const contentId = `content${currentTab.charAt(0).toUpperCase() + currentTab.slice(1)}`;
    const content = document.getElementById(contentId).innerText;
    const selectedTheme = document.getElementById('templateTheme').value;
    const logoInput = document.getElementById('companyLogo');

    if (!content || content.includes('will appear here')) {
      showAlert('No content to export', 'warning');
      return;
    }

    // Define theme styles
    const themeStyles = {
      'theme-default': 'background: linear-gradient(135deg, #ff8c42, #ff6b35); color: white;',
      'theme-modern': 'background: linear-gradient(135deg, #667eea, #764ba2); color: white;',
      'theme-professional': 'background: linear-gradient(135deg, #1e3c72, #2a5298); color: white;',
      'theme-vibrant': 'background: linear-gradient(135deg, #f093fb, #f5576c); color: white;',
      'theme-minimalist': 'background: linear-gradient(135deg, #ffffff, #f0f0f0); color: #333333; border: 2px solid #e0e0e0;',
      'theme-dark': 'background: linear-gradient(135deg, #232526, #414345); color: white;'
    };

    const selectedStyle = themeStyles[selectedTheme] || themeStyles['theme-default'];
    const companyName = document.getElementById('companyName').value || 'Company';
    const role = document.getElementById('role').value || 'Position';
    const companyWebsite = document.getElementById('companyWebsite').value || '';

    // Handle logo if uploaded
    let logoHtml = '';
    if (logoInput.files && logoInput.files[0]) {
      const reader = new FileReader();
      reader.onload = function(e) {
        logoHtml = '<div style="text-align: center; margin-bottom: 20px;"><img src="' + e.target.result + '" style="max-width: 150px; max-height: 100px; object-fit: contain;" /></div>';
        generatePDFWindow();
      };
      reader.readAsDataURL(logoInput.files[0]);
    } else {
      generatePDFWindow();
    }

    function generatePDFWindow() {
      // Create a styled PDF using a print dialog
      const printWindow = window.open('', '', 'height=800,width=1000');
      printWindow.document.write('<html><head><title>HR Content Export - ' + selectedTheme.replace('theme-', '') + '</title>');
      printWindow.document.write('<style>');
      printWindow.document.write('* { margin: 0; padding: 0; box-sizing: border-box; }');
      printWindow.document.write('body { font-family: "Segoe UI", Arial, sans-serif; padding: 0; }');
      printWindow.document.write('.template-container { ' + selectedStyle + ' padding: 60px; min-height: 100vh; }');
      printWindow.document.write('.template-header { text-align: center; margin-bottom: 40px; padding-bottom: 30px; border-bottom: 3px solid rgba(255,255,255,0.3); }');
      printWindow.document.write('.template-title { font-size: 48px; font-weight: 700; margin-bottom: 15px; }');
      printWindow.document.write('.template-subtitle { font-size: 24px; opacity: 0.9; }');
      printWindow.document.write('.template-content { font-size: 18px; line-height: 1.8; white-space: pre-wrap; margin: 40px 0; padding: 30px; background: rgba(255,255,255,0.1); border-radius: 12px; backdrop-filter: blur(10px); }');
      printWindow.document.write('.template-footer { text-align: center; margin-top: 50px; padding-top: 30px; border-top: 3px solid rgba(255,255,255,0.3); font-size: 20px; opacity: 0.85; }');
      printWindow.document.write('.meta-info { text-align: center; font-size: 14px; opacity: 0.7; margin-top: 20px; }');
      printWindow.document.write('@media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }');
      printWindow.document.write('</style>');
      printWindow.document.write('</head><body>');
      printWindow.document.write('<div class="template-container">');
      printWindow.document.write(logoHtml);
      printWindow.document.write('<div class="template-header">');
      printWindow.document.write('<div class="template-title">üéØ We Are Hiring!</div>');
      printWindow.document.write('<div class="template-subtitle">' + companyName + ' - ' + role + '</div>');
      printWindow.document.write('</div>');
      printWindow.document.write('<div class="template-content">' + content + '</div>');
      printWindow.document.write('<div class="template-footer">');
      printWindow.document.write(companyWebsite ? 'üåê ' + companyWebsite : 'üìß Apply Now');
      printWindow.document.write('</div>');
      printWindow.document.write('<div class="meta-info">Generated with HR Content Helper | ' + currentTab.toUpperCase() + ' Format | Theme: ' + selectedTheme.replace('theme-', '').toUpperCase() + '</div>');
      printWindow.document.write('</div>');
      printWindow.document.write('</body></html>');
      printWindow.document.close();
      
      // Wait a moment for styles and images to load before printing
      setTimeout(() => {
        printWindow.print();
      }, 500);
    }
  }

  function setLoading(loading, btnId) {
    const btn = document.getElementById(btnId);
    if (loading) {
      btn.disabled = true;
      btn.innerHTML = '<i data-lucide="loader-2"></i> Processing...';
      lucide.createIcons();
    } else {
      btn.disabled = false;
      if (btnId === 'promptBtn') {
        btn.innerHTML = '<i data-lucide="sparkles"></i> Enhance from Prompt';
      } else {
        btn.innerHTML = '<i data-lucide="sparkles"></i> Enhance from Form';
      }
      lucide.createIcons();
    }
  }

  function showError(message) {
    const errorDiv = document.getElementById('errorMsg');
    const errorText = document.getElementById('errorText');
    errorText.textContent = message;
    errorDiv.style.display = 'flex';
    
    setTimeout(() => {
      errorDiv.style.display = 'none';
    }, 5000);
  }

  function hideError() {
    document.getElementById('errorMsg').style.display = 'none';
  }

  async function applyTemplateAndDownload() {
    const contentId = `content${currentTab.charAt(0).toUpperCase() + currentTab.slice(1)}`;
    const content = document.getElementById(contentId).innerText;
    
    if (!content.trim() || content.includes('will appear here')) {
      showError("Please generate content first.");
      return;
    }
    try {
      const contentImage = document.getElementById('contentImage');
      const footerText = document.getElementById('footerText');
      const templateImage = document.getElementById('templateImage');
      const selectedTheme = document.getElementById('templateTheme').value;
      const logoContainer = document.getElementById('logoContainer');
      const templateLogo = document.getElementById('templateLogo');
      const logoInput = document.getElementById('companyLogo');
      
      // Apply selected theme
      templateImage.className = 'template ' + selectedTheme;
      
      // Handle logo if uploaded
      if (logoInput.files && logoInput.files[0]) {
        const reader = new FileReader();
        await new Promise((resolve) => {
          reader.onload = function(e) {
            templateLogo.src = e.target.result;
            logoContainer.style.display = 'block';
            resolve();
          };
          reader.readAsDataURL(logoInput.files[0]);
        });
      } else {
        logoContainer.style.display = 'none';
      }
      
      contentImage.innerHTML = content.replace(/\n/g, '<br>');
      footerText.innerText = document.getElementById('companyWebsite').value || "Apply Now";
      templateImage.style.display = "block";
      
      const canvas = await html2canvas(templateImage, { scale: 2, useCORS: true });
      const a = document.createElement("a");
      a.href = canvas.toDataURL();
      a.download = `LinkedIn_${currentTab}_${selectedTheme}_${Date.now()}.png`;
      a.click();
      templateImage.style.display = "none";
      hideError();
      showAlert('Image downloaded successfully!', 'success');
    } catch (err) {
      showError("Failed to generate image: " + err.message);
    }
  }

  // Update template preview (optional - could show a small preview)
  function updateTemplatePreview() {
    const selectedTheme = document.getElementById('templateTheme').value;
    showAlert(`Template theme changed to: ${selectedTheme.replace('theme-', '')}`, 'success');
  }

  // Theme toggle functionality
  function toggleTheme() {
    const html = document.documentElement;
    const themeIcon = document.querySelector('.theme-icon');
    
    if (html.getAttribute('data-theme') === 'dark') {
      html.removeAttribute('data-theme');
      themeIcon.setAttribute('data-lucide', 'sun');
    } else {
      html.setAttribute('data-theme', 'dark');
      themeIcon.setAttribute('data-lucide', 'moon');
    }
    
    // Re-render icons
    lucide.createIcons();
    
    // Save preference
    localStorage.setItem('theme', html.getAttribute('data-theme') || 'light');
  }

  // Load saved theme
  function loadTheme() {
    const savedTheme = localStorage.getItem('theme');
    const themeIcon = document.querySelector('.theme-icon');
    
    if (savedTheme === 'dark') {
      document.documentElement.setAttribute('data-theme', 'dark');
      themeIcon.setAttribute('data-lucide', 'moon');
    } else {
      themeIcon.setAttribute('data-lucide', 'sun');
    }
  }

  // Show alert messages
  function showAlert(message, type = 'info') {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert ${type} fade-in`;
    alertDiv.innerHTML = `
      <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'alert-circle' : 'info'}"></i>
      ${message}
    `;
    
    // Insert after header
    const header = document.querySelector('.header');
    header.parentNode.insertBefore(alertDiv, header.nextSibling);
    
    // Render icons
    lucide.createIcons();
    
    // Auto remove after 3 seconds
    setTimeout(() => {
      alertDiv.remove();
    }, 3000);
  }

  // Update auth error handling
  function showAuthError(message) {
    const errorDiv = document.getElementById('authError');
    const errorText = document.getElementById('authErrorText');
    errorText.textContent = message;
    errorDiv.style.display = 'flex';
    
    setTimeout(() => {
      errorDiv.style.display = 'none';
    }, 5000);
  }

  // Initialize on load
  document.addEventListener('DOMContentLoaded', function() {
    loadTheme();
    loadTemplates();
    lucide.createIcons();
  });
</script>

<script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

</body>
</html>
